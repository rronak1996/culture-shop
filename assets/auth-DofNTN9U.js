(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const p="https://script.google.com/macros/s/AKfycbxP2BUNvKrZOGF5fUAfXcXOv796T3kl0-65g8hWq-XpmeETj1p0h0-c46qxqSYNd7gs/exec",y="culture-secure-2025",i="culture_user",u="culture_token";async function f(e){const s=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function l(e,t){const s=new AbortController,o=setTimeout(()=>s.abort(),15e3);try{const r={action:e,apiKey:y,...t},n=await fetch(p,{method:"POST",redirect:"follow",signal:s.signal,headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(r)});return clearTimeout(o),await n.json()}catch(r){return clearTimeout(o),console.error("Auth request error:",r),r.name==="AbortError"?{success:!1,error:"Request timed out. Please check your connection and try again."}:{success:!1,error:r.message}}}function d(e,t){localStorage.setItem(i,JSON.stringify(e)),localStorage.setItem(u,t)}function a(){const e=localStorage.getItem(i);return e?JSON.parse(e):null}function S(){return localStorage.getItem(u)}function m(){return a()!==null&&S()!==null}function w(){localStorage.removeItem(i),localStorage.removeItem(u)}async function I(e,t,s,o){try{if(!e||!t||!s||!o)return{success:!1,error:"All fields are required"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return{success:!1,error:"Invalid email format"};if(o.length<6)return{success:!1,error:"Password must be at least 6 characters"};const n=await f(o),c=await l("signup",{name:e,email:t,mobile:s,password:n});return c.success&&d(c.user,c.token),c}catch(r){return console.error("Signup error:",r),{success:!1,error:"Signup failed. Please try again."}}}async function A(e,t){try{if(!e||!t)return{success:!1,error:"Email and password are required"};const s=await f(t),o=await l("login",{email:e,password:s});return o.success&&d(o.user,o.token),o}catch(s){return console.error("Login error:",s),{success:!1,error:"Login failed. Please check your credentials."}}}function O(){w(),window.location.href="/"}async function b(){try{const e=a();return e?await l("getUserOrders",{email:e.email}):{success:!1,error:"Not logged in"}}catch(e){return console.error("Get orders error:",e),{success:!1,error:"Failed to fetch orders"}}}function g(){const e=a(),t=document.querySelector(".auth-button");t&&(e?t.innerHTML=`
            <a href="account.html" class="btn btn-outline">
                <span>ðŸ‘¤</span> ${e.name}
            </a>
        `:t.innerHTML=`
            <a href="login.html" class="btn btn-outline">Login</a>
        `)}function h(){const e=a();if(!e)return;const t=document.getElementById("customer-name"),s=document.getElementById("customer-email"),o=document.getElementById("customer-mobile");t&&(t.value=e.name),s&&(s.value=e.email),o&&(o.value=e.mobile)}function E(){m()||(window.location.href="login.html")}document.addEventListener("DOMContentLoaded",()=>{g(),(window.location.pathname.includes("index.html")||window.location.pathname==="/")&&h()});window.auth={signup:I,login:A,logout:O,isLoggedIn:m,getCurrentUser:a,getUserOrders:b,requireAuth:E,updateHeaderUI:g,autoFillCheckout:h};
